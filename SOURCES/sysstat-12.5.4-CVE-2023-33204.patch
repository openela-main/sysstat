From 954ff2e2673cef48f0ed44668c466eab041db387 Mon Sep 17 00:00:00 2001
From: Pavel Kopylov <pkopylov@cloudlinux.com>
Date: Wed, 17 May 2023 11:33:45 +0200
Subject: [PATCH] Fix an overflow which is still possible for some values.
diff --git a/common.c b/common.c
index 583a0ca..6d73b1b 100644
--- a/common.c
+++ b/common.c
@@ -1639,9 +1639,11 @@ int parse_values(char *strargv, unsigned char bitmap[], int max_val, const char
  */
 void check_overflow(size_t val1, size_t val2, size_t val3)
 {
-	if ((unsigned long long) val1 *
-	    (unsigned long long) val2 *
-	    (unsigned long long) val3 > UINT_MAX) {
+if ((val1 != 0) && (val2 != 0) && (val3 != 0) &&
+		(((unsigned long long)UINT_MAX / (unsigned long long)val1 <
+		(unsigned long long)val2) ||
+		((unsigned long long)UINT_MAX / ((unsigned long long)val1 *
+		(unsigned long long)val2) < (unsigned long long)val3))) {
 #ifdef DEBUG
 		fprintf(stderr, "%s: Overflow detected (%llu). Aborting...\n",
 			__FUNCTION__,
